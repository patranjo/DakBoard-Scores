<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pro Sports - Houston Teams</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      /* Background: 'transparent' for Dakboard overlay, or use a color */
      --bg-color: transparent;
      
      /* Card styling */
      --card-bg: rgba(0, 0, 0, 0.75);
      --card-border: rgba(255, 255, 255, 0.1);
      --card-radius: 12px;
      
      /* Houston Colors (Texans: Navy/Red, Astros: Navy/Orange) */
      --houston-navy: #03202f;
      --houston-red: #a71930;
      --houston-orange: #eb6e1f;
      
      /* Favorite team highlight */
      --favorite-bg: rgba(3, 32, 47, 0.9);
      --favorite-border: var(--houston-orange);
      --favorite-glow: rgba(235, 110, 31, 0.4);
      
      /* Text colors */
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.5);
      
      /* Accent colors */
      --accent-live: #ef4444;
      --accent-final: #22c55e;
      --accent-upcoming: #3b82f6;
      
      /* Score styling */
      --score-winner: #fbbf24;
      
      /* Spacing */
      --widget-padding: 16px;
      --card-gap: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto Condensed', sans-serif;
      background: var(--bg-color);
      color: var(--text-primary);
      min-height: 100vh;
      padding: var(--widget-padding);
    }

    .widget-container {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    /* Section Header */
    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 8px;
      border-bottom: 3px solid var(--houston-orange);
    }

    .section-title {
      font-family: 'Oswald', sans-serif;
      font-size: 1.3rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* League Section */
    .league-section {
      display: flex;
      flex-direction: column;
      gap: var(--card-gap);
    }

    .league-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--card-border);
    }

    .league-logo {
      width: 28px;
      height: 28px;
      object-fit: contain;
    }

    .league-name {
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-secondary);
    }

    .section-icon {
      font-size: 1.4rem;
    }

    /* Games Grid */
    .games-grid {
      display: flex;
      flex-direction: column;
      gap: var(--card-gap);
    }

    /* Game Card */
    .game-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: var(--card-radius);
      padding: 14px 16px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .game-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    /* Houston Team Card */
    .game-card.houston-team {
      background: var(--favorite-bg);
      border: 2px solid var(--favorite-border);
      box-shadow: 0 0 20px var(--favorite-glow);
    }

    .game-card.houston-team .team-row.is-houston .team-name {
      font-weight: 700;
    }

    .houston-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      padding: 3px 8px;
      border-radius: 4px;
      background: linear-gradient(135deg, var(--houston-navy), var(--houston-orange));
      color: white;
      margin-left: 8px;
    }

    /* Game Status Badge */
    .game-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 4px 10px;
      border-radius: 20px;
      margin-bottom: 10px;
    }

    .game-status.live {
      background: var(--accent-live);
      color: white;
      animation: pulse 2s infinite;
    }

    .game-status.final {
      background: rgba(34, 197, 94, 0.2);
      color: var(--accent-final);
    }

    .game-status.upcoming {
      background: rgba(59, 130, 246, 0.2);
      color: var(--accent-upcoming);
    }

    .live-dot {
      width: 6px;
      height: 6px;
      background: white;
      border-radius: 50%;
      animation: blink 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* Teams Container */
    .teams-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* Team Row */
    .team-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .team-logo {
      width: 36px;
      height: 36px;
      object-fit: contain;
      flex-shrink: 0;
    }

    .team-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    .team-name-row {
      display: flex;
      align-items: center;
    }

    .team-name {
      font-family: 'Oswald', sans-serif;
      font-size: 1.1rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .team-record {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .team-score {
      font-family: 'Oswald', sans-serif;
      font-size: 1.6rem;
      font-weight: 700;
      min-width: 55px;
      text-align: right;
    }

    .team-row.winner .team-score {
      color: var(--score-winner);
    }

    .team-row.winner .team-name {
      color: var(--score-winner);
    }

    /* Game Info Footer */
    .game-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--card-border);
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .game-detail {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* Loading State */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: var(--text-secondary);
    }

    .loading-spinner {
      width: 24px;
      height: 24px;
      border: 3px solid var(--card-border);
      border-top-color: var(--houston-orange);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 12px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* No Games Message */
    .no-games {
      text-align: center;
      padding: 20px;
      color: var(--text-muted);
      font-style: italic;
    }

    /* Divider */
    .section-divider {
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--houston-orange), transparent);
      margin: 8px 0;
    }
  </style>
</head>
<body>

<div class="widget-container" id="widget">
  <div class="loading">
    <div class="loading-spinner"></div>
    <span>Loading scores...</span>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIGURATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const CONFIG = {
  // Houston teams to highlight
  houstonTeams: [
    { name: 'Houston Texans', abbreviations: ['HOU'], sport: 'football' },
    { name: 'Houston Astros', abbreviations: ['HOU'], sport: 'baseball' },
  ],
  
  // Leagues to display
  leagues: [
    { name: 'NFL', sport: 'football', league: 'nfl', icon: 'üèà' },
    { name: 'MLB', sport: 'baseball', league: 'mlb', icon: '‚öæ' },
  ],
  
  // Refresh interval (ms)
  refreshInterval: 60000,
  
  // Max games per league (null for no limit)
  maxGamesPerLeague: 8,
  
  // Show team records
  showRecords: true,
  
  // Show venue/broadcast
  showGameInfo: true,
  
  // Hide leagues with no games
  hideEmptyLeagues: false,
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Widget Code
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const widget = document.getElementById('widget');

async function fetchScores(sport, league) {
  const url = `https://site.api.espn.com/apis/site/v2/sports/${sport}/${league}/scoreboard`;
  
  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    return await response.json();
  } catch (error) {
    console.error(`Error fetching ${league}:`, error);
    return null;
  }
}

function isHoustonTeam(team, sport) {
  const name = (team.team.displayName || '').toUpperCase();
  const abbr = (team.team.abbreviation || '').toUpperCase();
  const location = (team.team.location || '').toUpperCase();
  
  // Check if it's a Houston team for this sport
  const houstonTeam = CONFIG.houstonTeams.find(ht => ht.sport === sport);
  if (!houstonTeam) return false;
  
  return location.includes('HOUSTON') || 
         name.includes('HOUSTON') ||
         (abbr === 'HOU');
}

function hasHoustonTeam(event, sport) {
  const competitors = event.competitions[0].competitors;
  return competitors.some(c => isHoustonTeam(c, sport));
}

function getGameStatus(competition) {
  const status = competition.status;
  const type = status.type;
  
  if (type.completed) {
    return { text: 'Final', class: 'final' };
  } else if (type.state === 'in') {
    // For baseball, show inning info
    const detail = status.type.shortDetail || status.type.detail;
    return { text: detail, class: 'live', isLive: true };
  } else {
    const date = new Date(competition.date);
    const timeStr = date.toLocaleTimeString('en-US', { 
      hour: 'numeric', 
      minute: '2-digit',
      hour12: true 
    });
    return { text: timeStr, class: 'upcoming' };
  }
}

function getTeamRecord(competitor) {
  if (!CONFIG.showRecords) return '';
  const records = competitor.records;
  if (!records || records.length === 0) return '';
  const overall = records.find(r => r.type === 'total' || r.name === 'overall') || records[0];
  return overall ? overall.summary : '';
}

function renderGame(event, isHouston, sport) {
  const competition = event.competitions[0];
  const status = getGameStatus(competition);
  const competitors = competition.competitors;
  
  // Sort so away team is first (top), home team second (bottom)
  const sortedTeams = [...competitors].sort((a, b) => {
    if (a.homeAway === 'away') return -1;
    return 1;
  });

  const isCompleted = competition.status.type.completed;
  
  // Determine winner
  let winnerId = null;
  if (isCompleted) {
    const scores = sortedTeams.map(t => parseInt(t.score) || 0);
    if (scores[0] !== scores[1]) {
      winnerId = scores[0] > scores[1] ? sortedTeams[0].id : sortedTeams[1].id;
    }
  }

  const teamsHtml = sortedTeams.map(team => {
    const isWinner = team.id === winnerId;
    const isHou = isHoustonTeam(team, sport);
    const record = getTeamRecord(team);
    const logo = team.team.logo || '';
    const score = competition.status.type.state === 'pre' ? '' : team.score;
    
    return `
      <div class="team-row ${isWinner ? 'winner' : ''} ${isHou ? 'is-houston' : ''}">
        <img class="team-logo" src="${logo}" alt="${team.team.abbreviation}" onerror="this.style.display='none'">
        <div class="team-info">
          <div class="team-name-row">
            <span class="team-name">${team.team.displayName || team.team.shortDisplayName}</span>
            ${isHou ? '<span class="houston-badge">‚≠ê HTX</span>' : ''}
          </div>
          ${record ? `<span class="team-record">${record}</span>` : ''}
        </div>
        <span class="team-score">${score}</span>
      </div>
    `;
  }).join('');

  // Game info
  let gameInfoHtml = '';
  if (CONFIG.showGameInfo) {
    const venue = competition.venue?.fullName || '';
    const broadcast = competition.broadcasts?.[0]?.names?.[0] || '';
    
    if (venue || broadcast) {
      gameInfoHtml = `
        <div class="game-info">
          ${venue ? `<span class="game-detail">${venue}</span>` : '<span></span>'}
          ${broadcast ? `<span class="game-detail">${broadcast}</span>` : ''}
        </div>
      `;
    }
  }

  return `
    <div class="game-card ${isHouston ? 'houston-team' : ''}">
      <div class="game-status ${status.class}">
        ${status.isLive ? '<span class="live-dot"></span>' : ''}
        ${status.text}
      </div>
      <div class="teams-container">
        ${teamsHtml}
      </div>
      ${gameInfoHtml}
    </div>
  `;
}

function renderLeague(leagueConfig, data) {
  if (!data || !data.events || data.events.length === 0) {
    if (CONFIG.hideEmptyLeagues) return '';
    return `
      <div class="league-section">
        <div class="league-header">
          <span class="section-icon">${leagueConfig.icon}</span>
          <span class="league-name">${leagueConfig.name}</span>
        </div>
        <div class="no-games">No games scheduled</div>
      </div>
    `;
  }

  let events = data.events;
  
  // Separate Houston games and other games
  const houstonGames = events.filter(e => hasHoustonTeam(e, leagueConfig.sport));
  const otherGames = events.filter(e => !hasHoustonTeam(e, leagueConfig.sport));
  
  // Sort other games: live first, then upcoming, then final
  otherGames.sort((a, b) => {
    const aState = a.competitions[0].status.type.state;
    const bState = b.competitions[0].status.type.state;
    const order = { 'in': 0, 'pre': 1, 'post': 2 };
    return (order[aState] ?? 3) - (order[bState] ?? 3);
  });

  // Combine: Houston first, then others
  let allGames = [...houstonGames, ...otherGames];
  
  // Limit if configured
  if (CONFIG.maxGamesPerLeague) {
    allGames = allGames.slice(0, CONFIG.maxGamesPerLeague);
  }

  const leagueLogo = data.leagues?.[0]?.logos?.[0]?.href || '';

  const gamesHtml = allGames.map(event => {
    const isHouston = hasHoustonTeam(event, leagueConfig.sport);
    return renderGame(event, isHouston, leagueConfig.sport);
  }).join('');

  return `
    <div class="league-section">
      <div class="league-header">
        ${leagueLogo ? `<img class="league-logo" src="${leagueLogo}" alt="${leagueConfig.name}">` : `<span class="section-icon">${leagueConfig.icon}</span>`}
        <span class="league-name">${leagueConfig.name}</span>
      </div>
      <div class="games-grid">
        ${gamesHtml}
      </div>
    </div>
  `;
}

async function updateWidget() {
  const results = await Promise.all(
    CONFIG.leagues.map(async league => {
      const data = await fetchScores(league.sport, league.league);
      return { config: league, data };
    })
  );

  const sectionsHtml = results
    .map(result => renderLeague(result.config, result.data))
    .filter(html => html !== '')
    .join('<div class="section-divider"></div>');

  if (sectionsHtml) {
    widget.innerHTML = `
      <div class="section-header">
        <span class="section-title">üèüÔ∏è Pro Sports</span>
      </div>
      ${sectionsHtml}
    `;
  } else {
    widget.innerHTML = `
      <div class="section-header">
        <span class="section-title">üèüÔ∏è Pro Sports</span>
      </div>
      <div class="no-games">No games scheduled for today</div>
    `;
  }
}

// Initial load
updateWidget();

// Auto-refresh
setInterval(updateWidget, CONFIG.refreshInterval);
</script>

</body>
</html>
