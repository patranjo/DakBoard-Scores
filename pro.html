<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pro Scoreboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: transparent;
      --text-primary: #fff;
      --text-muted: rgba(255,255,255,0.5);
      --accent-color: #eb6e1f;
      --houston-color: #03202f;
      --score-winner: #fbbf24;
      --line-color: rgba(255,255,255,0.3);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      font-family: 'Oswald', sans-serif;
      background: var(--bg-color);
      color: var(--text-primary);
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    .widget {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      flex-direction: column;
      padding: 8px 12px;
    }
    .header {
      font-size: 1.4rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding-bottom: 6px;
      border-bottom: 2px solid var(--accent-color);
      margin-bottom: 8px;
      flex-shrink: 0;
    }
    .scroll-container {
      flex: 1;
      position: relative;
      overflow: hidden;
      min-height: 0;
    }
    .scroll-content {
      position: absolute;
      top: 0; left: 0; right: 0;
      display: flex;
      flex-direction: column;
    }
    .league-label {
      font-size: 1rem;
      font-weight: 500;
      text-transform: uppercase;
      color: #000;
      background: var(--accent-color);
      padding: 2px 8px;
      margin: 8px 0 6px 0;
      display: inline-block;
      align-self: flex-start;
    }
    .league-label:first-child {
      margin-top: 0;
    }
    .game {
      border-bottom: 1px solid var(--line-color);
      padding: 8px 0;
    }
    .game:last-child {
      border-bottom: none;
    }
    .game.favorite .team-row.is-hou .team-name {
      color: var(--accent-color);
      font-weight: 700;
    }
    .game-content {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    .teams {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }
    .team-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .team-logo {
      width: 24px;
      height: 24px;
      object-fit: contain;
      flex-shrink: 0;
    }
    .team-name {
      font-size: 1.3rem;
      font-weight: 500;
    }
    .team-row.winner .team-name,
    .team-row.winner .score { 
      color: var(--score-winner); 
    }
    .score {
      font-size: 1.3rem;
      font-weight: 700;
      min-width: 30px;
      text-align: right;
      margin-left: auto;
    }
    .game-info {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      text-align: right;
      min-width: 80px;
      padding-left: 10px;
    }
    .game-time {
      font-size: 1.2rem;
      font-weight: 500;
    }
    .game-time.live {
      color: #ef4444;
    }
    .game-time.final {
      color: #4ade80;
    }
    .game-network {
      font-size: 0.75rem;
      color: var(--text-muted);
      font-weight: 600;
      text-transform: uppercase;
    }
    .no-games {
      text-align: center;
      padding: 20px;
      color: var(--text-muted);
      font-size: 1.1rem;
    }
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--text-muted);
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
<div class="widget">
  <div class="header">Pro Scoreboard</div>
  <div class="scroll-container" id="scrollContainer">
    <div class="scroll-content" id="content">
      <div class="loading">Loading...</div>
    </div>
  </div>
</div>

<script>
const CONFIG = {
  houstonTeams: { football: 'HOU', baseball: 'HOU' },
  leagues: [
    { name: 'NFL', sport: 'football', league: 'nfl' },
    { name: 'MLB', sport: 'baseball', league: 'mlb' },
  ],
  refreshInterval: 60000,
  scrollPauseMs: 2000,
  scrollPixelsPerStep: 1,
  scrollIntervalMs: 30,
  maxAgeHours: 24,
};

const content = document.getElementById('content');
const container = document.getElementById('scrollContainer');
let scrollPos = 0, scrollDir = 1, isPaused = true, scrollInterval = null;

function isHouston(team) {
  const abbr = (team.team.abbreviation || '').toUpperCase();
  const loc = (team.team.location || '').toUpperCase();
  return abbr === 'HOU' || loc.includes('HOUSTON');
}

function hasHouston(e) { return e.competitions[0].competitors.some(isHouston); }

function isWithin24Hours(e) {
  const gameDate = new Date(e.competitions[0].date);
  const now = new Date();
  const hoursDiff = (now - gameDate) / (1000 * 60 * 60);
  return hoursDiff < CONFIG.maxAgeHours && hoursDiff > -48;
}

async function fetchScores(sport, league) {
  try {
    const r = await fetch(`https://site.api.espn.com/apis/site/v2/sports/${sport}/${league}/scoreboard`);
    return r.ok ? r.json() : null;
  } catch { return null; }
}

function getStatus(comp) {
  const t = comp.status.type;
  if (t.completed) return { txt: 'Final', cls: 'final', state: 'post' };
  if (t.state === 'in') return { txt: t.shortDetail || 'Live', cls: 'live', state: 'in' };
  const d = new Date(comp.date);
  return { txt: d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }).toLowerCase(), cls: '', state: 'pre' };
}

function renderGame(ev, isHou) {
  const comp = ev.competitions[0];
  const st = getStatus(comp);
  const teams = [...comp.competitors].sort((a,b) => a.homeAway === 'away' ? -1 : 1);
  const done = comp.status.type.completed;
  const inProgress = comp.status.type.state === 'in';
  
  let winnerId = null;
  if (done) {
    const s = teams.map(t => parseInt(t.score)||0);
    if (s[0] !== s[1]) winnerId = s[0] > s[1] ? teams[0].id : teams[1].id;
  }

  const network = comp.broadcasts?.[0]?.names?.[0] || '';

  const teamsHtml = teams.map(t => {
    const w = t.id === winnerId;
    const h = isHouston(t);
    const logo = t.team.logo || '';
    const score = (done || inProgress) ? t.score : '';
    const abbr = t.team.abbreviation || '';
    const name = t.team.shortDisplayName || t.team.displayName;
    
    return `<div class="team-row ${w?'winner':''} ${h?'is-hou':''}">
      <img class="team-logo" src="${logo}" onerror="this.style.display='none'">
      <span class="team-name">${abbr} ${name}</span>
      ${score ? `<span class="score">${score}</span>` : ''}
    </div>`;
  }).join('');

  return `<div class="game ${isHou?'favorite':''}">
    <div class="game-content">
      <div class="teams">${teamsHtml}</div>
      <div class="game-info">
        <span class="game-time ${st.cls}">${st.txt}</span>
        ${network ? `<span class="game-network">${network}</span>` : ''}
      </div>
    </div>
  </div>`;
}

async function update() {
  const results = await Promise.all(CONFIG.leagues.map(async l => {
    const data = await fetchScores(l.sport, l.league);
    return { league: l, data };
  }));
  
  let html = '';
  results.forEach(({ league, data }) => {
    if (!data?.events?.length) return;
    
    let games = data.events.filter(isWithin24Hours);
    if (!games.length) return;
    
    const houGames = games.filter(hasHouston);
    const other = games.filter(e => !hasHouston(e)).sort((a,b) => {
      const order = { 'in': 0, 'pre': 1, 'post': 2 };
      return (order[a.competitions[0].status.type.state]??3) - (order[b.competitions[0].status.type.state]??3);
    });
    games = [...houGames, ...other];
    
    html += `<div class="league-label">${league.name}</div>`;
    html += games.map(e => renderGame(e, hasHouston(e))).join('');
  });
  
  content.innerHTML = html || '<div class="no-games">No games today</div>';
  
  scrollPos = 0;
  scrollDir = 1;
  content.style.transform = 'translateY(0)';
  startScrolling();
}

function startScrolling() {
  if (scrollInterval) clearInterval(scrollInterval);
  isPaused = true;
  setTimeout(() => {
    isPaused = false;
    scrollInterval = setInterval(doScroll, CONFIG.scrollIntervalMs);
  }, CONFIG.scrollPauseMs);
}

function doScroll() {
  if (isPaused) return;
  const contentH = content.offsetHeight;
  const containerH = container.offsetHeight;
  if (contentH <= containerH) return;
  
  scrollPos += CONFIG.scrollPixelsPerStep;
  
  // When we've scrolled past all content, loop back to top
  if (scrollPos >= contentH) {
    scrollPos = 0;
    isPaused = true;
    setTimeout(() => { isPaused = false; }, CONFIG.scrollPauseMs);
  }
  
  content.style.transform = `translateY(-${scrollPos}px)`;
}

update();
setInterval(update, CONFIG.refreshInterval);
</script>
</body>
</html>
