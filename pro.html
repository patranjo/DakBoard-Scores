<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pro Sports - Houston</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: transparent;
      --card-bg: rgba(0, 0, 0, 0.7);
      --card-border: rgba(255, 255, 255, 0.1);
      --houston-navy: #03202f;
      --houston-orange: #eb6e1f;
      --favorite-bg: rgba(3, 32, 47, 0.9);
      --text-primary: #fff;
      --text-muted: rgba(255,255,255,0.5);
      --accent-live: #ef4444;
      --accent-final: #22c55e;
      --accent-upcoming: #3b82f6;
      --score-winner: #fbbf24;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      font-family: 'Roboto Condensed', sans-serif;
      background: var(--bg-color);
      color: var(--text-primary);
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    .widget {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      padding: 4px;
    }
    .header {
      font-family: 'Oswald', sans-serif;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      padding: 3px 0;
      border-bottom: 2px solid var(--houston-orange);
      margin-bottom: 4px;
      flex-shrink: 0;
    }
    .scroll-container {
      flex: 1;
      position: relative;
      overflow: hidden;
      min-height: 0;
    }
    .scroll-content {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    .league-label {
      font-family: 'Oswald', sans-serif;
      font-size: 0.55rem;
      font-weight: 500;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 2px 0 1px;
      border-bottom: 1px solid var(--card-border);
    }
    .game {
      display: flex;
      align-items: center;
      background: var(--card-bg);
      border-radius: 4px;
      padding: 3px 4px;
      gap: 4px;
      border: 1px solid var(--card-border);
    }
    .game.favorite {
      background: var(--favorite-bg);
      border-color: var(--houston-orange);
    }
    .status {
      font-size: 0.45rem;
      font-weight: 700;
      text-transform: uppercase;
      padding: 1px 3px;
      border-radius: 2px;
      white-space: nowrap;
      min-width: 32px;
      text-align: center;
    }
    .status.live { background: var(--accent-live); }
    .status.final { background: rgba(34,197,94,0.25); color: var(--accent-final); }
    .status.upcoming { background: rgba(59,130,246,0.25); color: var(--accent-upcoming); }
    .matchup {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1px;
      min-width: 0;
    }
    .team-line {
      display: flex;
      align-items: center;
      gap: 3px;
    }
    .team-logo {
      width: 12px;
      height: 12px;
      object-fit: contain;
      flex-shrink: 0;
    }
    .team-name {
      font-family: 'Oswald', sans-serif;
      font-size: 0.6rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;
    }
    .team-line.winner .team-name,
    .team-line.winner .score { color: var(--score-winner); }
    .team-line.is-hou .team-name { font-weight: 700; }
    .hou-badge {
      font-size: 0.4rem;
      background: linear-gradient(135deg, var(--houston-navy), var(--houston-orange));
      padding: 0px 2px;
      border-radius: 2px;
      font-weight: 700;
    }
    .score {
      font-family: 'Oswald', sans-serif;
      font-size: 0.6rem;
      font-weight: 700;
      min-width: 16px;
      text-align: right;
    }
    .no-games {
      text-align: center;
      padding: 10px;
      color: var(--text-muted);
      font-size: 0.55rem;
    }
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--text-muted);
      font-size: 0.55rem;
    }
  </style>
</head>
<body>
<div class="widget">
  <div class="header">Pro Scoreboard</div>
  <div class="scroll-container" id="scrollContainer">
    <div class="scroll-content" id="content">
      <div class="loading">Loading...</div>
    </div>
  </div>
</div>

<script>
const CONFIG = {
  houstonTeams: { football: 'HOU', baseball: 'HOU' },
  leagues: [
    { name: 'NFL', sport: 'football', league: 'nfl' },
    { name: 'MLB', sport: 'baseball', league: 'mlb' },
  ],
  refreshInterval: 60000,
  scrollPauseMs: 2000,
  scrollPixelsPerStep: 1,
  scrollIntervalMs: 30,
  maxAgeHours: 24,
};

const content = document.getElementById('content');
const container = document.getElementById('scrollContainer');
let scrollPos = 0;
let scrollDir = 1;
let isPaused = true;
let scrollInterval = null;

function isHouston(team) {
  const abbr = (team.team.abbreviation || '').toUpperCase();
  const loc = (team.team.location || '').toUpperCase();
  return abbr === 'HOU' || loc.includes('HOUSTON');
}

function hasHouston(e) { return e.competitions[0].competitors.some(isHouston); }

function isWithin24Hours(e) {
  const gameDate = new Date(e.competitions[0].date);
  const now = new Date();
  const hoursDiff = (now - gameDate) / (1000 * 60 * 60);
  return hoursDiff < CONFIG.maxAgeHours && hoursDiff > -48;
}

async function fetchScores(sport, league) {
  try {
    const r = await fetch(`https://site.api.espn.com/apis/site/v2/sports/${sport}/${league}/scoreboard`);
    return r.ok ? r.json() : null;
  } catch { return null; }
}

function getStatus(comp) {
  const t = comp.status.type;
  if (t.completed) return { txt: 'Final', cls: 'final' };
  if (t.state === 'in') return { txt: t.shortDetail || 'Live', cls: 'live' };
  const d = new Date(comp.date);
  return { txt: d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }), cls: 'upcoming' };
}

function renderGame(ev, isHou) {
  const comp = ev.competitions[0];
  const st = getStatus(comp);
  const teams = [...comp.competitors].sort((a,b) => a.homeAway === 'away' ? -1 : 1);
  const done = comp.status.type.completed;
  let winnerId = null;
  if (done) {
    const s = teams.map(t => parseInt(t.score)||0);
    if (s[0] !== s[1]) winnerId = s[0] > s[1] ? teams[0].id : teams[1].id;
  }
  const teamsHtml = teams.map(t => {
    const w = t.id === winnerId;
    const h = isHouston(t);
    const logo = t.team.logo || '';
    const score = comp.status.type.state === 'pre' ? '' : t.score;
    return `<div class="team-line ${w?'winner':''} ${h?'is-hou':''}">
      <img class="team-logo" src="${logo}" onerror="this.style.display='none'">
      <span class="team-name">${t.team.shortDisplayName || t.team.displayName}</span>
      ${h ? '<span class="hou-badge">HTX</span>' : ''}
      <span class="score">${score}</span>
    </div>`;
  }).join('');
  return `<div class="game ${isHou?'favorite':''}">
    <div class="status ${st.cls}">${st.txt}</div>
    <div class="matchup">${teamsHtml}</div>
  </div>`;
}

async function update() {
  const results = await Promise.all(CONFIG.leagues.map(async l => {
    const data = await fetchScores(l.sport, l.league);
    return { league: l, data };
  }));
  
  let html = '';
  results.forEach(({ league, data }) => {
    if (!data?.events?.length) return;
    let games = data.events.filter(isWithin24Hours);
    if (!games.length) return;
    const houGames = games.filter(hasHouston);
    const other = games.filter(e => !hasHouston(e)).sort((a,b) => {
      const order = { 'in': 0, 'pre': 1, 'post': 2 };
      return (order[a.competitions[0].status.type.state]??3) - (order[b.competitions[0].status.type.state]??3);
    });
    games = [...houGames, ...other];
    html += `<div class="league-label">${league.name}</div>`;
    html += games.map(e => renderGame(e, hasHouston(e))).join('');
  });
  
  content.innerHTML = html || '<div class="no-games">No games today</div>';
  
  scrollPos = 0;
  scrollDir = 1;
  content.style.transform = 'translateY(0)';
  startScrolling();
}

function startScrolling() {
  if (scrollInterval) clearInterval(scrollInterval);
  
  isPaused = true;
  setTimeout(() => {
    isPaused = false;
    scrollInterval = setInterval(doScroll, CONFIG.scrollIntervalMs);
  }, CONFIG.scrollPauseMs);
}

function doScroll() {
  if (isPaused) return;
  
  const contentH = content.offsetHeight;
  const containerH = container.offsetHeight;
  
  if (contentH <= containerH) return;
  
  const maxScroll = contentH - containerH;
  scrollPos += scrollDir * CONFIG.scrollPixelsPerStep;
  
  if (scrollPos >= maxScroll) {
    scrollPos = maxScroll;
    scrollDir = -1;
    isPaused = true;
    setTimeout(() => { isPaused = false; }, CONFIG.scrollPauseMs);
  } else if (scrollPos <= 0) {
    scrollPos = 0;
    scrollDir = 1;
    isPaused = true;
    setTimeout(() => { isPaused = false; }, CONFIG.scrollPauseMs);
  }
  
  content.style.transform = `translateY(-${scrollPos}px)`;
}

update();
setInterval(update, CONFIG.refreshInterval);
</script>
</body>
</html>
