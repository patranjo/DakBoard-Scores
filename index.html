<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>College Sports - Aggies & SEC</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: transparent;
      --card-bg: rgba(0, 0, 0, 0.7);
      --card-border: rgba(255, 255, 255, 0.1);
      --aggie-maroon: #500000;
      --favorite-bg: rgba(80, 0, 0, 0.85);
      --text-primary: #fff;
      --text-muted: rgba(255,255,255,0.5);
      --accent-live: #ef4444;
      --accent-final: #22c55e;
      --accent-upcoming: #3b82f6;
      --score-winner: #fbbf24;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Roboto Condensed', sans-serif;
      background: var(--bg-color);
      color: var(--text-primary);
      height: 100vh;
      overflow: hidden;
    }
    .widget {
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 8px;
    }
    .header {
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 6px 0;
      border-bottom: 2px solid var(--aggie-maroon);
      margin-bottom: 8px;
      flex-shrink: 0;
    }
    .scroll-container {
      flex: 1;
      overflow: hidden;
      position: relative;
    }
    .scroll-content {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .scroll-content.animating {
      transition: transform 0.5s ease-in-out;
    }
    /* League label */
    .league-label {
      font-family: 'Oswald', sans-serif;
      font-size: 0.7rem;
      font-weight: 500;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 4px 0 2px;
      border-bottom: 1px solid var(--card-border);
      margin-top: 4px;
    }
    .league-label:first-child { margin-top: 0; }
    /* Game row */
    .game {
      display: flex;
      align-items: center;
      background: var(--card-bg);
      border-radius: 6px;
      padding: 6px 8px;
      gap: 6px;
      border: 1px solid var(--card-border);
    }
    .game.favorite {
      background: var(--favorite-bg);
      border-color: var(--aggie-maroon);
    }
    .status {
      font-size: 0.55rem;
      font-weight: 700;
      text-transform: uppercase;
      padding: 2px 5px;
      border-radius: 3px;
      white-space: nowrap;
      min-width: 42px;
      text-align: center;
    }
    .status.live { background: var(--accent-live); }
    .status.final { background: rgba(34,197,94,0.25); color: var(--accent-final); }
    .status.upcoming { background: rgba(59,130,246,0.25); color: var(--accent-upcoming); }
    .matchup {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }
    .team-line {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .team-logo {
      width: 18px;
      height: 18px;
      object-fit: contain;
      flex-shrink: 0;
    }
    .rank {
      font-size: 0.6rem;
      color: var(--score-winner);
    }
    .team-name {
      font-family: 'Oswald', sans-serif;
      font-size: 0.8rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;
    }
    .team-line.winner .team-name,
    .team-line.winner .score { color: var(--score-winner); }
    .team-line.is-fav .team-name { font-weight: 700; }
    .score {
      font-family: 'Oswald', sans-serif;
      font-size: 0.85rem;
      font-weight: 700;
      min-width: 24px;
      text-align: right;
    }
    .no-games {
      text-align: center;
      padding: 20px;
      color: var(--text-muted);
      font-style: italic;
    }
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
<div class="widget">
  <div class="header">ðŸŽ“ Aggies & SEC</div>
  <div class="scroll-container" id="scrollContainer">
    <div class="scroll-content" id="content">
      <div class="loading">Loading...</div>
    </div>
  </div>
</div>

<script>
const CONFIG = {
  favoriteTeam: ['TAMU', 'TA&M', 'TEXAS A&M'],
  secTeams: ['TAMU','TA&M','ALA','BAMA','ARK','AUB','FLA','UGA','GA','UK','LSU','MISS','OLE MISS','MSST','MIZ','OKLA','OU','SCAR','SC','TENN','TEX','TEXAS','VAN','VANDY'],
  secNames: ['Texas A&M','Alabama','Arkansas','Auburn','Florida','Georgia','Kentucky','LSU','Ole Miss','Mississippi State','Missouri','Oklahoma','South Carolina','Tennessee','Texas','Vanderbilt'],
  leagues: [
    { name: 'CFB', sport: 'football', league: 'college-football' },
    { name: 'CBB', sport: 'basketball', league: 'mens-college-basketball' },
    { name: 'Baseball', sport: 'baseball', league: 'college-baseball' },
  ],
  refreshInterval: 60000,
  scrollPauseMs: 3000,
  scrollStepMs: 50,
};

const content = document.getElementById('content');
const container = document.getElementById('scrollContainer');
let scrollPos = 0, scrollDir = 1, isPaused = false, pauseTimeout = null;

function isFavorite(team) {
  const abbr = (team.team.abbreviation || '').toUpperCase();
  const name = (team.team.displayName || '').toUpperCase();
  return CONFIG.favoriteTeam.some(f => abbr === f || name.includes(f));
}

function isSec(team) {
  const abbr = (team.team.abbreviation || '').toUpperCase();
  const name = (team.team.displayName || '').toUpperCase();
  return CONFIG.secTeams.includes(abbr) || CONFIG.secNames.some(n => name.includes(n.toUpperCase()));
}

function isSecGame(e) { return e.competitions[0].competitors.some(isSec); }
function hasFav(e) { return e.competitions[0].competitors.some(isFavorite); }

async function fetchScores(sport, league) {
  try {
    const r = await fetch(`https://site.api.espn.com/apis/site/v2/sports/${sport}/${league}/scoreboard`);
    return r.ok ? r.json() : null;
  } catch { return null; }
}

function getStatus(comp) {
  const t = comp.status.type;
  if (t.completed) return { txt: 'Final', cls: 'final' };
  if (t.state === 'in') return { txt: t.shortDetail || 'Live', cls: 'live' };
  const d = new Date(comp.date);
  return { txt: d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }), cls: 'upcoming' };
}

function renderGame(ev, fav) {
  const comp = ev.competitions[0];
  const st = getStatus(comp);
  const teams = [...comp.competitors].sort((a,b) => a.homeAway === 'away' ? -1 : 1);
  const done = comp.status.type.completed;
  let winnerId = null;
  if (done) {
    const s = teams.map(t => parseInt(t.score)||0);
    if (s[0] !== s[1]) winnerId = s[0] > s[1] ? teams[0].id : teams[1].id;
  }
  const teamsHtml = teams.map(t => {
    const w = t.id === winnerId;
    const f = isFavorite(t);
    const rank = t.curatedRank?.current;
    const logo = t.team.logo || '';
    const score = comp.status.type.state === 'pre' ? '' : t.score;
    return `<div class="team-line ${w?'winner':''} ${f?'is-fav':''}">
      <img class="team-logo" src="${logo}" onerror="this.style.display='none'">
      ${rank && rank <= 25 ? `<span class="rank">#${rank}</span>` : ''}
      <span class="team-name">${t.team.shortDisplayName || t.team.displayName}</span>
      <span class="score">${score}</span>
    </div>`;
  }).join('');
  return `<div class="game ${fav?'favorite':''}">
    <div class="status ${st.cls}">${st.txt}</div>
    <div class="matchup">${teamsHtml}</div>
  </div>`;
}

async function update() {
  const results = await Promise.all(CONFIG.leagues.map(async l => {
    const data = await fetchScores(l.sport, l.league);
    return { league: l, data };
  }));
  
  let html = '';
  results.forEach(({ league, data }) => {
    if (!data?.events) return;
    let games = data.events.filter(isSecGame);
    if (!games.length) return;
    const favGames = games.filter(hasFav);
    const other = games.filter(e => !hasFav(e)).sort((a,b) => {
      const order = { 'in': 0, 'pre': 1, 'post': 2 };
      return (order[a.competitions[0].status.type.state]??3) - (order[b.competitions[0].status.type.state]??3);
    });
    games = [...favGames, ...other];
    html += `<div class="league-label">${league.name}</div>`;
    html += games.map(e => renderGame(e, hasFav(e))).join('');
  });
  
  content.innerHTML = html || '<div class="no-games">No SEC games today</div>';
  scrollPos = 0;
  content.style.transform = 'translateY(0)';
}

function autoScroll() {
  if (isPaused) return;
  const contentH = content.scrollHeight;
  const containerH = container.clientHeight;
  if (contentH <= containerH) return;
  
  const maxScroll = contentH - containerH;
  scrollPos += scrollDir * 1;
  
  if (scrollPos >= maxScroll) {
    scrollPos = maxScroll;
    scrollDir = -1;
    pause();
  } else if (scrollPos <= 0) {
    scrollPos = 0;
    scrollDir = 1;
    pause();
  }
  content.style.transform = `translateY(-${scrollPos}px)`;
}

function pause() {
  isPaused = true;
  clearTimeout(pauseTimeout);
  pauseTimeout = setTimeout(() => { isPaused = false; }, CONFIG.scrollPauseMs);
}

update();
setInterval(update, CONFIG.refreshInterval);
setInterval(autoScroll, CONFIG.scrollStepMs);
</script>
</body>
</html>
