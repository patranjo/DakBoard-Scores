<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>College Sports - Aggies, SEC & Top 25</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: transparent;
      --card-bg: rgba(0, 0, 0, 0.7);
      --card-border: rgba(255, 255, 255, 0.1);
      --aggie-maroon: #500000;
      --favorite-bg: rgba(80, 0, 0, 0.85);
      --top25-bg: rgba(251, 191, 36, 0.15);
      --top25-border: rgba(251, 191, 36, 0.4);
      --text-primary: #fff;
      --text-muted: rgba(255,255,255,0.5);
      --accent-live: #ef4444;
      --accent-final: #22c55e;
      --accent-upcoming: #3b82f6;
      --score-winner: #fbbf24;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      font-family: 'Roboto Condensed', sans-serif;
      background: var(--bg-color);
      color: var(--text-primary);
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    .widget {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      padding: 4px;
    }
    .header {
      font-family: 'Oswald', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      padding: 3px 0;
      border-bottom: 2px solid var(--aggie-maroon);
      margin-bottom: 4px;
      flex-shrink: 0;
    }
    .scroll-container {
      flex: 1;
      position: relative;
      overflow: hidden;
      min-height: 0;
    }
    .scroll-content {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    .league-label {
      font-family: 'Oswald', sans-serif;
      font-size: 1.1rem;
      font-weight: 500;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 2px 0 1px;
      border-bottom: 1px solid var(--card-border);
    }
    .section-label {
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      font-weight: 500;
      text-transform: uppercase;
      color: var(--score-winner);
      padding: 3px 0 1px;
      margin-top: 2px;
    }
    .game {
      display: flex;
      align-items: center;
      background: var(--card-bg);
      border-radius: 6px;
      padding: 6px 8px;
      gap: 8px;
      border: 1px solid var(--card-border);
    }
    .game.favorite {
      background: var(--favorite-bg);
      border-color: var(--aggie-maroon);
    }
    .game.top25 {
      background: var(--top25-bg);
      border-color: var(--top25-border);
    }
    .game.favorite.top25 {
      background: var(--favorite-bg);
      border-color: var(--aggie-maroon);
    }
    .status {
      font-size: 0.9rem;
      font-weight: 700;
      text-transform: uppercase;
      padding: 2px 5px;
      border-radius: 3px;
      white-space: nowrap;
      min-width: 50px;
      text-align: center;
    }
    .status.live { background: var(--accent-live); }
    .status.final { background: rgba(34,197,94,0.25); color: var(--accent-final); }
    .status.upcoming { background: rgba(59,130,246,0.25); color: var(--accent-upcoming); }
    .matchup {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1px;
      min-width: 0;
    }
    .team-line {
      display: flex;
      align-items: center;
      gap: 3px;
    }
    .team-logo {
      width: 24px;
      height: 24px;
      object-fit: contain;
      flex-shrink: 0;
    }
    .rank {
      font-size: 1rem;
      color: var(--score-winner);
    }
    .team-name {
      font-family: 'Oswald', sans-serif;
      font-size: 1.2rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;
    }
    .team-line.winner .team-name,
    .team-line.winner .score { color: var(--score-winner); }
    .team-line.is-fav .team-name { font-weight: 700; }
    .score {
      font-family: 'Oswald', sans-serif;
      font-size: 1.2rem;
      font-weight: 700;
      min-width: 24px;
      text-align: right;
    }
    .no-games {
      text-align: center;
      padding: 10px;
      color: var(--text-muted);
      font-size: 1.1rem;
    }
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--text-muted);
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
<div class="widget">
  <div class="header">College Scoreboard</div>
  <div class="scroll-container" id="scrollContainer">
    <div class="scroll-content" id="content">
      <div class="loading">Loading...</div>
    </div>
  </div>
</div>

<script>
const CONFIG = {
  favoriteTeam: ['TAMU', 'TA&M', 'TEXAS A&M'],
  secTeams: ['TAMU','TA&M','ALA','BAMA','ARK','AUB','FLA','UGA','GA','UK','LSU','MISS','OLE MISS','MSST','MIZ','OKLA','OU','SCAR','SC','TENN','TEX','TEXAS','VAN','VANDY'],
  secNames: ['Texas A&M','Alabama','Arkansas','Auburn','Florida','Georgia','Kentucky','LSU','Ole Miss','Mississippi State','Missouri','Oklahoma','South Carolina','Tennessee','Texas','Vanderbilt'],
  leagues: [
    { name: 'CFB', sport: 'football', league: 'college-football' },
    { name: 'CBB', sport: 'basketball', league: 'mens-college-basketball' },
    { name: 'Baseball', sport: 'baseball', league: 'college-baseball' },
  ],
  refreshInterval: 60000,
  scrollPauseMs: 2000,
  scrollPixelsPerStep: 1,
  scrollIntervalMs: 30,
  maxAgeHours: 24,
};

const content = document.getElementById('content');
const container = document.getElementById('scrollContainer');
let scrollPos = 0;
let scrollDir = 1;
let isPaused = true;
let scrollInterval = null;

function isFavorite(team) {
  const abbr = (team.team.abbreviation || '').toUpperCase();
  const name = (team.team.displayName || '').toUpperCase();
  return CONFIG.favoriteTeam.some(f => abbr === f || name.includes(f));
}

function isSec(team) {
  const abbr = (team.team.abbreviation || '').toUpperCase();
  const name = (team.team.displayName || '').toUpperCase();
  return CONFIG.secTeams.includes(abbr) || CONFIG.secNames.some(n => name.includes(n.toUpperCase()));
}

function isRanked(team) {
  const rank = team.curatedRank?.current;
  return rank && rank <= 25;
}

function isSecGame(e) { return e.competitions[0].competitors.some(isSec); }
function hasFav(e) { return e.competitions[0].competitors.some(isFavorite); }
function hasTop25(e) { return e.competitions[0].competitors.some(isRanked); }

function isWithin24Hours(e) {
  const gameDate = new Date(e.competitions[0].date);
  const now = new Date();
  const hoursDiff = (now - gameDate) / (1000 * 60 * 60);
  return hoursDiff < CONFIG.maxAgeHours && hoursDiff > -48;
}

async function fetchScores(sport, league) {
  try {
    const r = await fetch(`https://site.api.espn.com/apis/site/v2/sports/${sport}/${league}/scoreboard`);
    return r.ok ? r.json() : null;
  } catch { return null; }
}

function getStatus(comp) {
  const t = comp.status.type;
  if (t.completed) return { txt: 'Final', cls: 'final' };
  if (t.state === 'in') return { txt: t.shortDetail || 'Live', cls: 'live' };
  const d = new Date(comp.date);
  return { txt: d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }), cls: 'upcoming' };
}

function renderGame(ev, fav, top25) {
  const comp = ev.competitions[0];
  const st = getStatus(comp);
  const teams = [...comp.competitors].sort((a,b) => a.homeAway === 'away' ? -1 : 1);
  const done = comp.status.type.completed;
  let winnerId = null;
  if (done) {
    const s = teams.map(t => parseInt(t.score)||0);
    if (s[0] !== s[1]) winnerId = s[0] > s[1] ? teams[0].id : teams[1].id;
  }
  const teamsHtml = teams.map(t => {
    const w = t.id === winnerId;
    const f = isFavorite(t);
    const rank = t.curatedRank?.current;
    const logo = t.team.logo || '';
    const score = comp.status.type.state === 'pre' ? '' : t.score;
    return `<div class="team-line ${w?'winner':''} ${f?'is-fav':''}">
      <img class="team-logo" src="${logo}" onerror="this.style.display='none'">
      ${rank && rank <= 25 ? `<span class="rank">#${rank}</span>` : ''}
      <span class="team-name">${t.team.shortDisplayName || t.team.displayName}</span>
      <span class="score">${score}</span>
    </div>`;
  }).join('');
  
  let cardClass = 'game';
  if (fav) cardClass += ' favorite';
  else if (top25) cardClass += ' top25';
  
  return `<div class="${cardClass}">
    <div class="status ${st.cls}">${st.txt}</div>
    <div class="matchup">${teamsHtml}</div>
  </div>`;
}

async function update() {
  const results = await Promise.all(CONFIG.leagues.map(async l => {
    const data = await fetchScores(l.sport, l.league);
    return { league: l, data };
  }));
  
  let html = '';
  results.forEach(({ league, data }) => {
    if (!data?.events) return;
    
    // Filter to recent games only
    let allGames = data.events.filter(isWithin24Hours);
    if (!allGames.length) return;
    
    // Categorize games
    const favGames = allGames.filter(hasFav);
    const secGames = allGames.filter(e => isSecGame(e) && !hasFav(e));
    const top25Games = allGames.filter(e => hasTop25(e) && !isSecGame(e) && !hasFav(e));
    
    // Skip league if no relevant games
    if (!favGames.length && !secGames.length && !top25Games.length) return;
    
    // Sort helper: live first, then upcoming, then final
    const sortGames = (games) => games.sort((a,b) => {
      const order = { 'in': 0, 'pre': 1, 'post': 2 };
      return (order[a.competitions[0].status.type.state]??3) - (order[b.competitions[0].status.type.state]??3);
    });
    
    html += `<div class="league-label">${league.name}</div>`;
    
    // Aggies first
    if (favGames.length) {
      html += favGames.map(e => renderGame(e, true, hasTop25(e))).join('');
    }
    
    // SEC games
    if (secGames.length) {
      if (favGames.length) html += `<div class="section-label">SEC</div>`;
      html += sortGames(secGames).map(e => renderGame(e, false, hasTop25(e))).join('');
    }
    
    // Top 25 (non-SEC)
    if (top25Games.length) {
      html += `<div class="section-label">Top 25</div>`;
      html += sortGames(top25Games).map(e => renderGame(e, false, true)).join('');
    }
  });
  
  content.innerHTML = html || '<div class="no-games">No games today</div>';
  
  scrollPos = 0;
  scrollDir = 1;
  content.style.transform = 'translateY(0)';
  startScrolling();
}

function startScrolling() {
  if (scrollInterval) clearInterval(scrollInterval);
  
  isPaused = true;
  setTimeout(() => {
    isPaused = false;
    scrollInterval = setInterval(doScroll, CONFIG.scrollIntervalMs);
  }, CONFIG.scrollPauseMs);
}

function doScroll() {
  if (isPaused) return;
  
  const contentH = content.offsetHeight;
  const containerH = container.offsetHeight;
  
  if (contentH <= containerH) return;
  
  const maxScroll = contentH - containerH;
  scrollPos += scrollDir * CONFIG.scrollPixelsPerStep;
  
  if (scrollPos >= maxScroll) {
    scrollPos = maxScroll;
    scrollDir = -1;
    isPaused = true;
    setTimeout(() => { isPaused = false; }, CONFIG.scrollPauseMs);
  } else if (scrollPos <= 0) {
    scrollPos = 0;
    scrollDir = 1;
    isPaused = true;
    setTimeout(() => { isPaused = false; }, CONFIG.scrollPauseMs);
  }
  
  content.style.transform = `translateY(-${scrollPos}px)`;
}

update();
setInterval(update, CONFIG.refreshInterval);
</script>
</body>
</html>
