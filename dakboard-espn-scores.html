<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sports Scores - Dakboard Widget</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    /* ═══════════════════════════════════════════════════════════════
       CONFIGURATION - Edit these variables to customize your widget
       ═══════════════════════════════════════════════════════════════ */
    :root {
      /* Background: 'transparent' for Dakboard overlay, or use a color */
      --bg-color: transparent;
      
      /* Card styling */
      --card-bg: rgba(0, 0, 0, 0.75);
      --card-border: rgba(255, 255, 255, 0.1);
      --card-radius: 12px;
      
      /* Text colors */
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.5);
      
      /* Accent colors */
      --accent-live: #ef4444;
      --accent-final: #22c55e;
      --accent-upcoming: #3b82f6;
      
      /* Score styling */
      --score-winner: #fbbf24;
      
      /* Spacing */
      --widget-padding: 16px;
      --card-gap: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto Condensed', sans-serif;
      background: var(--bg-color);
      color: var(--text-primary);
      min-height: 100vh;
      padding: var(--widget-padding);
    }

    .widget-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* League Section */
    .league-section {
      display: flex;
      flex-direction: column;
      gap: var(--card-gap);
    }

    .league-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--card-border);
    }

    .league-logo {
      width: 28px;
      height: 28px;
      object-fit: contain;
    }

    .league-name {
      font-family: 'Oswald', sans-serif;
      font-size: 1.1rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-secondary);
    }

    /* Games Grid */
    .games-grid {
      display: flex;
      flex-direction: column;
      gap: var(--card-gap);
    }

    /* Game Card */
    .game-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: var(--card-radius);
      padding: 14px 16px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .game-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    /* Game Status Badge */
    .game-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 4px 10px;
      border-radius: 20px;
      margin-bottom: 10px;
    }

    .game-status.live {
      background: var(--accent-live);
      color: white;
      animation: pulse 2s infinite;
    }

    .game-status.final {
      background: rgba(34, 197, 94, 0.2);
      color: var(--accent-final);
    }

    .game-status.upcoming {
      background: rgba(59, 130, 246, 0.2);
      color: var(--accent-upcoming);
    }

    .live-dot {
      width: 6px;
      height: 6px;
      background: white;
      border-radius: 50%;
      animation: blink 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* Teams Container */
    .teams-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* Team Row */
    .team-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .team-logo {
      width: 32px;
      height: 32px;
      object-fit: contain;
      flex-shrink: 0;
    }

    .team-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    .team-name {
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .team-record {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .team-score {
      font-family: 'Oswald', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      min-width: 50px;
      text-align: right;
    }

    .team-row.winner .team-score {
      color: var(--score-winner);
    }

    .team-row.winner .team-name {
      color: var(--score-winner);
    }

    /* Game Info Footer */
    .game-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--card-border);
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .game-detail {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* Loading State */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: var(--text-secondary);
    }

    .loading-spinner {
      width: 24px;
      height: 24px;
      border: 3px solid var(--card-border);
      border-top-color: var(--text-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 12px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Error State */
    .error-message {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: var(--card-radius);
      padding: 16px;
      color: #fca5a5;
      text-align: center;
    }

    /* No Games Message */
    .no-games {
      text-align: center;
      padding: 20px;
      color: var(--text-muted);
      font-style: italic;
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--card-border);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }
  </style>
</head>
<body>

<div class="widget-container" id="widget">
  <div class="loading">
    <div class="loading-spinner"></div>
    <span>Loading scores...</span>
  </div>
</div>

<script>
// ═══════════════════════════════════════════════════════════════════════════
// CONFIGURATION - Edit these settings to customize your widget
// ═══════════════════════════════════════════════════════════════════════════

const CONFIG = {
  // Which leagues to display (comment out any you don't want)
  leagues: [
    { name: 'NFL', sport: 'football', league: 'nfl' },
    { name: 'NBA', sport: 'basketball', league: 'nba' },
    { name: 'NHL', sport: 'hockey', league: 'nhl' },
    { name: 'MLB', sport: 'baseball', league: 'mlb' },
    // { name: 'College Football', sport: 'football', league: 'college-football' },
    // { name: 'College Basketball', sport: 'basketball', league: 'mens-college-basketball' },
    // { name: 'WNBA', sport: 'basketball', league: 'wnba' },
    // { name: 'MLS', sport: 'soccer', league: 'usa.1' },
    // { name: 'Premier League', sport: 'soccer', league: 'eng.1' },
  ],
  
  // How often to refresh scores (in milliseconds)
  // 60000 = 1 minute, 30000 = 30 seconds
  refreshInterval: 60000,
  
  // Maximum games to show per league (set to null for no limit)
  maxGamesPerLeague: 5,
  
  // Show games from how many days ago? (0 = today only)
  daysBack: 0,
  
  // Show games for how many days ahead? (0 = today only)
  daysAhead: 0,
  
  // Only show leagues that have games today
  hideEmptyLeagues: true,
  
  // Show team records (W-L)
  showRecords: true,
  
  // Show venue/broadcast info
  showGameInfo: true,
};

// ═══════════════════════════════════════════════════════════════════════════
// Widget Code - You shouldn't need to edit below this line
// ═══════════════════════════════════════════════════════════════════════════

const widget = document.getElementById('widget');

async function fetchScores(sport, league) {
  const url = `https://site.api.espn.com/apis/site/v2/sports/${sport}/${league}/scoreboard`;
  
  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    return await response.json();
  } catch (error) {
    console.error(`Error fetching ${league}:`, error);
    return null;
  }
}

function getGameStatus(competition) {
  const status = competition.status;
  const type = status.type;
  
  if (type.completed) {
    return { text: 'Final', class: 'final' };
  } else if (type.state === 'in') {
    const detail = status.displayClock 
      ? `${status.period}${getOrdinalSuffix(status.period)} ${status.displayClock}`
      : status.type.shortDetail;
    return { text: detail, class: 'live', isLive: true };
  } else {
    // Upcoming
    const date = new Date(competition.date);
    const timeStr = date.toLocaleTimeString('en-US', { 
      hour: 'numeric', 
      minute: '2-digit',
      hour12: true 
    });
    return { text: timeStr, class: 'upcoming' };
  }
}

function getOrdinalSuffix(n) {
  const s = ['th', 'st', 'nd', 'rd'];
  const v = n % 100;
  return s[(v - 20) % 10] || s[v] || s[0];
}

function getTeamRecord(competitor) {
  if (!CONFIG.showRecords) return '';
  const records = competitor.records;
  if (!records || records.length === 0) return '';
  const overall = records.find(r => r.type === 'total' || r.name === 'overall') || records[0];
  return overall ? overall.summary : '';
}

function renderGame(event) {
  const competition = event.competitions[0];
  const status = getGameStatus(competition);
  const competitors = competition.competitors;
  
  // Sort so home team is second (bottom)
  const sortedTeams = [...competitors].sort((a, b) => {
    if (a.homeAway === 'away') return -1;
    return 1;
  });

  const isCompleted = competition.status.type.completed;
  
  // Determine winner for completed games
  let winnerId = null;
  if (isCompleted) {
    const scores = sortedTeams.map(t => parseInt(t.score) || 0);
    if (scores[0] !== scores[1]) {
      winnerId = scores[0] > scores[1] ? sortedTeams[0].id : sortedTeams[1].id;
    }
  }

  const teamsHtml = sortedTeams.map(team => {
    const isWinner = team.id === winnerId;
    const record = getTeamRecord(team);
    const logo = team.team.logo || '';
    const score = competition.status.type.state === 'pre' ? '' : team.score;
    
    return `
      <div class="team-row ${isWinner ? 'winner' : ''}">
        <img class="team-logo" src="${logo}" alt="${team.team.abbreviation}" onerror="this.style.display='none'">
        <div class="team-info">
          <span class="team-name">${team.team.shortDisplayName || team.team.displayName}</span>
          ${record ? `<span class="team-record">${record}</span>` : ''}
        </div>
        <span class="team-score">${score}</span>
      </div>
    `;
  }).join('');

  // Game info (venue, broadcast)
  let gameInfoHtml = '';
  if (CONFIG.showGameInfo) {
    const venue = competition.venue?.fullName || '';
    const broadcast = competition.broadcasts?.[0]?.names?.[0] || '';
    
    if (venue || broadcast) {
      gameInfoHtml = `
        <div class="game-info">
          ${venue ? `<span class="game-detail">${venue}</span>` : '<span></span>'}
          ${broadcast ? `<span class="game-detail">${broadcast}</span>` : ''}
        </div>
      `;
    }
  }

  return `
    <div class="game-card">
      <div class="game-status ${status.class}">
        ${status.isLive ? '<span class="live-dot"></span>' : ''}
        ${status.text}
      </div>
      <div class="teams-container">
        ${teamsHtml}
      </div>
      ${gameInfoHtml}
    </div>
  `;
}

function renderLeague(leagueConfig, data) {
  if (!data || !data.events || data.events.length === 0) {
    if (CONFIG.hideEmptyLeagues) return '';
    return `
      <div class="league-section">
        <div class="league-header">
          <span class="league-name">${leagueConfig.name}</span>
        </div>
        <div class="no-games">No games scheduled</div>
      </div>
    `;
  }

  let events = data.events;
  
  // Limit games if configured
  if (CONFIG.maxGamesPerLeague) {
    events = events.slice(0, CONFIG.maxGamesPerLeague);
  }

  // Get league logo from first event if available
  const leagueLogo = data.leagues?.[0]?.logos?.[0]?.href || '';

  const gamesHtml = events.map(event => renderGame(event)).join('');

  return `
    <div class="league-section">
      <div class="league-header">
        ${leagueLogo ? `<img class="league-logo" src="${leagueLogo}" alt="${leagueConfig.name}">` : ''}
        <span class="league-name">${leagueConfig.name}</span>
      </div>
      <div class="games-grid">
        ${gamesHtml}
      </div>
    </div>
  `;
}

async function updateWidget() {
  const results = await Promise.all(
    CONFIG.leagues.map(async league => {
      const data = await fetchScores(league.sport, league.league);
      return { config: league, data };
    })
  );

  const html = results
    .map(result => renderLeague(result.config, result.data))
    .filter(html => html !== '')
    .join('');

  if (html) {
    widget.innerHTML = html;
  } else {
    widget.innerHTML = '<div class="no-games">No games scheduled for today</div>';
  }
}

// Initial load
updateWidget();

// Set up auto-refresh
setInterval(updateWidget, CONFIG.refreshInterval);
</script>

</body>
</html>
